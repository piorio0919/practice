Order WorkFlow



Order Micro Service
주문 및 구매, 취소등에 관련된 일련의 Process


결제 대기 현황
결제 대기중 : 결제 할것인가 말것인가 어느것으로 할것인가 등.(아마 다른 Service)
생성된 오더에 대한 결제완료 가능->주문현황
일정 시간이 지날 시나 결제를 취소할시->결제만료/취소현황


주문현황
현재 주문현황 확인
새로운 사용자(소매, 도매등)에 의해 Order생성
재고있음, 재고없음, 부분재고없음 Domain과 연결
재고있음 : 현재 생성될 Order(사용자->소매상,소매상->도매상등)에게 재고가 존재함.(거래 가능)
재고없음 : 현재 생성될 Order에게 
부분재고없음 : 단체 주문에서의(ex:에어컨2대) 부분적 재고 보유
재고있음 ->상품준비중현황  *중요*(새로운 Order 생성됨)
재고없음->재고없음현황
부분재고없음->새로운 도메인 오더항목 수정과 부분환불.
*이 이후의 Flow는 결제취소가 아니라 반품으로 들어갑니다*

재고없음 현황
재고가 있는지 없는지 확인가능
재고가 없으므로 그 Order는 결제 취소
ex)에어컨이 10대있는줄 알았는데 9대라 한대는 취소되어야함
ex2)소매상에게 에어컨이 없어서 설치를 못함.
출고 완료 전까지는 언제나 재고가 없어질 수 있음.

상품준비중현황
***이곳부터는 사용자 결제 취소 불가능! 반품으로 처리됩니다***
새로운 Order가 생성되는순간(상품이 준비되는순간부터) 결제취소 불가능
반품신청시 반품진행현황으로
상품이 준비되었나 안되었나 등 확인 가능
발주진행 Flow에따라 완료되면 발주확인현황으로 or 재고가 존재하지 않는다면 
재고있음, 기사배정 배송지 선택 Domain 배송지 선택 Domain
재고있음->파트너 매입->매입주문생성 ->발주확인현황
ex)판매 소매상에서 도매상에게 매입선택
파트너매입 : 등록된 도매상 등 쓱싹을 이용할 매체에게서 매입(고로 Order 새로 생성)
매입주문생성 : 새로운 Order생성 ->발주확인현황
플로우가 정상적으로 진행되면 두개가 생성됨. 기사배정 Order와 파트너 도매상의 Order
재고있음->비파트너 매입->매입거래생성 ->발주확인현황
비파트너 매입:등록되지 않은 도매상에게서 구입
매입거래 생성:새로운 에어컨 구입 Order가 생성되는것이 아니라 영수증개념으로 생성
기존재고 선택->기존재고 SKU할당
기존재고 선택 : 기존에 소매 or 도매가 가지고있는 재고로 사용됨.
기사배정->설치주문생성
기사배정 : 설치에 따른 새로운 기사 필요
설치주문생성 : 배정되면 새로운 Order생성(설치기사용)
배송지선택 : 어디로 배송할것인지.
ex)고객이면 자신의 집주소등, 소 도매상끼리는 소도매 주소가 됩니다.(사용자에 따라 달라짐)


발주확인현황
반품신청시 반품진행현황으로
발주상황을 확인가능
발주가 완료될시 발주완료현황으로 (연결된 Order가 발주완료할시)
재고가 없을시 재고없음현황으로
발주취소시 재고없음현황으로


발주완료현황
반품신청시 반품진행현황으로
최종 출고시 출고완료현황으로
교환신청시에는 교환진행현황으로


출고완료현황
최종 출고가 완료됨
구매자가 구매확정을 하면 구매확정현황으로
교환신청시 교환진행현황으로
반품신청시 반품진행현황으로
설치자 배송완료 : 설치자가 실제 이용자에게 전달함.
설치완료 : 설치완료(이순간에 설치가 불가능 할 수도있으니 반품진행현황으로 갈 수도 있습니다)
(질문할곳, 설치 불가능하게 처리될 시 반품으로 처리? 결제취소 처리?)
설치자 배송완료->설치완료


구매확정현황
그 Order에 대한 사용자가 구매확정처리하는곳
이곳에서 Order는 종료됩니다.(일반적인 거래완료)
리뷰작성가능


반품진행현황
두가지 Flow
환불승인 환불거절 두가지 Case
환불거절시 그냥 거절
환불 승인시 ->수거완료 ->반품완료순으로 진행
(질문할곳, 수거도 OrderService에서 새로운 Order 생성합니까?)


교환진행현황
교환을 원할시 사용되는 곳
교환거절
교환 승인시 수거하고 반품할 것인지
아니면 제품이 추가될것인지 나뉨
교환승인→수거완료->반품완료
반품과 똑같은 Flow
제품추가→재고있음→출고완료→구매확정->교환완료
Order에 새로운 제품이 추가되며 상품준비중 현황부터 새로이 시작됨.
